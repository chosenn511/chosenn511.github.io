{"componentChunkName":"component---src-templates-post-tsx","path":"/ggcloudDeploy_04/","result":{"data":{"markdownRemark":{"html":"<p>이번 포스팅에서는 Google Cloud Storage를 사용하여 정적 파일을 저장해줄 버킷을 생성하고 연동하는 방법에 대해서 알아볼 예정이다.</p>\n<br>\n<h2 id=\"1-cloud-storage에-버킷-생성\" style=\"position:relative;\"><a href=\"#1-cloud-storage%EC%97%90-%EB%B2%84%ED%82%B7-%EC%83%9D%EC%84%B1\" aria-label=\"1 cloud storage에 버킷 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Cloud Storage에 버킷 생성</h2>\n<p>구글 클라우드 플랫폼에서는 Gunicorn 서버를 사용하여 앱을 배포한다. 하지만 Gunicorn 서버는 정적 파일을 서빙하지 않기 때문에 따로 Cloud Storage를 생성하여 정적파일을 서빙해줘야 한다.</p>\n<p>먼저 버켓을 생성하고 기본적으로 버켓을 공개해놓는다.</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token comment\"># 버켓 생성</span>\n$ gsutil mb gs:<span class=\"token operator\">/</span><span class=\"token operator\">/</span>&lt;버켓이름>\n\n<span class=\"token comment\"># 기본 공개 설정</span>\n$ gsutil defacl <span class=\"token function\">set</span> public<span class=\"token operator\">-</span>read gs:<span class=\"token operator\">/</span><span class=\"token operator\">/</span>&lt;버켓이름></code></pre></div>\n<br>\n<p>장고로 돌아와서, 프로젝트 내의 정적파일을 한 폴더에 모아준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>manage<span class=\"token punctuation\">.</span>py collectstatic</code></pre></div>\n<br>\n<p>파일이 <code class=\"language-text\">static/</code> 안에 모두 모였다면 버켓과 해당 폴더를 연결해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token comment\"># gsutil rsync -R static/ gs://&lt;버켓이름>/static</span></code></pre></div>\n<p>연결해 준 후에는 <code class=\"language-text\">settings.py</code>의 <code class=\"language-text\">STATIC_URL</code>을 다음과 같이 바꿔준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># settings.py</span>\n\nSTATIC_URL<span class=\"token operator\">=</span><span class=\"token string\">\"http://storage.googleapis.com/&lt;버켓이름>/static/\"</span></code></pre></div>\n<p>완료! 이제 Kubernetes 엔진을 생성해보자.</p>\n<br>\n<h2 id=\"2-kubernetes-엔진-클러스터-생성하기\" style=\"position:relative;\"><a href=\"#2-kubernetes-%EC%97%94%EC%A7%84-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0\" aria-label=\"2 kubernetes 엔진 클러스터 생성하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Kubernetes 엔진 클러스터 생성하기</h2>\n<h3 id=\"1-클러스터-생성\" style=\"position:relative;\"><a href=\"#1-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EC%83%9D%EC%84%B1\" aria-label=\"1 클러스터 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(1) 클러스터 생성</h3>\n<a href=\"https://console.cloud.google.com/kubernetes\" target=\"_blank\">\nKubernetes 엔진 콘솔 페이지</a>에서 엔진 준비가 된 것을 확인한 후에 다음 명령어로 클러스터를 만들어준다.\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">$ gcloud container clusters create <span class=\"token function\">test-app</span> \\\n  <span class=\"token operator\">--</span>scopes <span class=\"token string\">\"https://www.googleapis.com/auth/userinfo.email\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"cloud-platform\"</span> \\\n  <span class=\"token operator\">--</span>num<span class=\"token operator\">-</span>nodes 2 <span class=\"token operator\">--</span>zone <span class=\"token string\">\"asia-northeast1-a\"</span></code></pre></div>\n<br>\n<h3 id=\"2-클러스터-확인\" style=\"position:relative;\"><a href=\"#2-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%ED%99%95%EC%9D%B8\" aria-label=\"2 클러스터 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(2) 클러스터 확인</h3>\n<p>클러스터를 만들고 나서는 <code class=\"language-text\">kubectl</code> 명령어로 클러스터 설정을 제공할 예정이므로 만들어준 클러스터 인스턴스를 쓸 것임을 다음 명령어로 확인해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ gcloud container clusters get-credentials test-app --zone &quot;asia-northeast1-a&quot;</code></pre></div>\n<br>\n<h3 id=\"3-클러스터-시크릿파일-설정\" style=\"position:relative;\"><a href=\"#3-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EC%8B%9C%ED%81%AC%EB%A6%BF%ED%8C%8C%EC%9D%BC-%EC%84%A4%EC%A0%95\" aria-label=\"3 클러스터 시크릿파일 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(3) 클러스터 시크릿파일 설정</h3>\n<p>인스턴스 수준의 접근을 허용하는 크레덴셜 파일을 생성한다. 해당 json 파일은 서비스 계정 생성시 받은 파일이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">$ kubectl create secret generic cloudsql<span class=\"token operator\">-</span>oauth<span class=\"token operator\">-</span>credentials <span class=\"token operator\">--</span><span class=\"token keyword\">from</span><span class=\"token operator\">-</span>file=credentials<span class=\"token punctuation\">.</span>json=<span class=\"token punctuation\">[</span>프로젝트 내 credentials<span class=\"token punctuation\">.</span>json의 상대경로<span class=\"token punctuation\">]</span></code></pre></div>\n<br>\n<p>두 번째 시크릿 파일은 데이터베이스에 접근하기 위한 파일이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">$ kubectl create secret generic cloudsql <span class=\"token operator\">--</span><span class=\"token keyword\">from</span><span class=\"token operator\">-</span>literal=username=<span class=\"token punctuation\">[</span>데이터베이스 사용자명<span class=\"token punctuation\">]</span> <span class=\"token operator\">--</span><span class=\"token keyword\">from</span><span class=\"token operator\">-</span>literal=password=<span class=\"token punctuation\">[</span>비밀번호값<span class=\"token punctuation\">]</span></code></pre></div>\n<p>두 파일 모두 만들어 주면 엔진 사용설정은 끝이 난다.</p>\n<br>","excerpt":"이번 포스팅에서는 Google Cloud Storage를 사용하여 정적 파일을 저장해줄 버킷을 생성하고 연동하는 방법에 대해서 알아볼 예정이다. 1. Cloud Storage에 버킷 생성 구글 클라우드 플랫폼에서는 Gunicorn 서버를 사용하여 앱…","tableOfContents":"<ul>\n<li><a href=\"/ggcloudDeploy_04/#1-cloud-storage%EC%97%90-%EB%B2%84%ED%82%B7-%EC%83%9D%EC%84%B1\">1. Cloud Storage에 버킷 생성</a></li>\n<li>\n<p><a href=\"/ggcloudDeploy_04/#2-kubernetes-%EC%97%94%EC%A7%84-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0\">2. Kubernetes 엔진 클러스터 생성하기</a></p>\n<ul>\n<li><a href=\"/ggcloudDeploy_04/#1-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EC%83%9D%EC%84%B1\">(1) 클러스터 생성</a></li>\n<li><a href=\"/ggcloudDeploy_04/#2-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%ED%99%95%EC%9D%B8\">(2) 클러스터 확인</a></li>\n<li><a href=\"/ggcloudDeploy_04/#3-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EC%8B%9C%ED%81%AC%EB%A6%BF%ED%8C%8C%EC%9D%BC-%EC%84%A4%EC%A0%95\">(3) 클러스터 시크릿파일 설정</a></li>\n</ul>\n</li>\n</ul>","fields":{"slug":"/ggcloudDeploy_04/"},"frontmatter":{"title":"Google News Lab > 4. Kubernetes 버킷 및 클러스터 엔진 생성","date":"Jan 29, 2018","tags":["Google News Lab","Kubernetes","Django"],"keywords":["development note","bbrubi"],"update":"Jan 01, 0001"}}},"pageContext":{"slug":"/ggcloudDeploy_04/","series":[{"slug":"/ggcloudDeploy_01/","title":"Google News Lab > 1. 구글 클라우드 플랫폼을 사용한 배포 전 준비","num":1},{"slug":"/ggcloudDeploy_02/","title":"Google News Lab > 2. 프록시 서버 및 데이터베이스 구축","num":2},{"slug":"/ggcloudDeploy_03/","title":"Google News Lab > 3. Kubernetes 엔진 생성 전 설정","num":3},{"slug":"/ggcloudDeploy_04/","title":"Google News Lab > 4. Kubernetes 버킷 및 클러스터 엔진 생성","num":4},{"slug":"/ggcloudDeploy_05/","title":"Google News Lab > 5. 도커파일 생성 및 배포","num":5},{"slug":"/ggcloudDeploy_07/","title":"Google News Lab > 장고로 만든 웹사이트에 커스텀 파비콘(.ico) 적용시키기","num":7}],"lastmod":"2018-01-29"}},"staticQueryHashes":["2027115977","694178885"]}