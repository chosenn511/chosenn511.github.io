{"componentChunkName":"component---src-templates-post-tsx","path":"/ggcloudDeploy_03/","result":{"data":{"markdownRemark":{"html":"<p>이번 포스팅에서는 서비스 계정을 생성하여 Kubernetes 엔진 환경을 구성하는 방식에 대해 설명할 예정이다.</p>\n<br>\n<h2 id=\"1-서비스-계정service-account-생성\" style=\"position:relative;\"><a href=\"#1-%EC%84%9C%EB%B9%84%EC%8A%A4-%EA%B3%84%EC%A0%95service-account-%EC%83%9D%EC%84%B1\" aria-label=\"1 서비스 계정service account 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 서비스 계정(Service Account) 생성</h2>\n<p>서비스 계정은 IAM 내에서 제공중이다. <a href=\"https://console.cloud.google.com/projectselector/iam-admin/serviceaccounts\" target=\"_blank\">해당 콘솔페이지</a>에서 콘솔 탭메뉴의 <code class=\"language-text\">IAM</code>을 선택한 후 <code class=\"language-text\">서비스 계정</code> 탭을 눌러 알맞은 프로젝트 내에 계정을 생성하면 된다.</p>\n<p>이 때, 역할에서 <code class=\"language-text\">Cloud SQL</code> 내의 <code class=\"language-text\">Cloud SQL Client</code>를 부여해준다. 이 서비스 계정 ID는 반드시 유일할 필요는 없지만 알아보기 쉬운 프로젝트 관련 이름으로 정해주는 것이 좋다.</p>\n<p>계정 생성이 완료되면 <code class=\"language-text\">json</code>으로 선택한 프라이빗 키 파일이 다운받아진다. 이 키는 서비스계정을인스턴스에 연결할 때, 엔진 생성할 때 필요하므로 안전한 곳에 보관한다.</p>\n<br>\n<h2 id=\"2-kubernetes쿠버네트-엔진-환경설정-생성\" style=\"position:relative;\"><a href=\"#2-kubernetes%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8A%B8-%EC%97%94%EC%A7%84-%ED%99%98%EA%B2%BD%EC%84%A4%EC%A0%95-%EC%83%9D%EC%84%B1\" aria-label=\"2 kubernetes쿠버네트 엔진 환경설정 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Kubernetes(쿠버네트) 엔진 환경설정 생성</h2>\n<p>이전 포스팅에서 구글 엔진용 배포 환경설정 파일로  <code class=\"language-text\">app.yaml</code>을 생성해주어야 한다고 언급했다.</p>\n<p>이제 이 파일을 생성해보자. 이 때도 <code class=\"language-text\">connectionName</code>이 필요하다. 이 부분을 생략했다면 이전 포스팅을 참고하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># app.yaml</span>\n\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> extensions/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> test<span class=\"token punctuation\">-</span>app\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> test\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span>\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> test\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> test<span class=\"token punctuation\">-</span>app\n        <span class=\"token comment\"># Replace  with your project ID or use `make template`</span>\n        <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> gcr.io/&lt;프로젝트명<span class=\"token punctuation\">></span>/test\n        <span class=\"token comment\"># This setting makes nodes pull the docker image every time before</span>\n        <span class=\"token comment\"># starting the pod. This is useful when debugging, but should be turned</span>\n        <span class=\"token comment\"># off in production.</span>\n        <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> Always\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> DATABASE_USER\n              <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">secretKeyRef</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cloudsql\n                  <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> username\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> DATABASE_PASSWORD\n              <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">secretKeyRef</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cloudsql\n                  <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> password\n        <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8080</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> b.gcr.io/cloudsql<span class=\"token punctuation\">-</span>docker/gce<span class=\"token punctuation\">-</span>proxy<span class=\"token punctuation\">:</span><span class=\"token number\">1.05</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cloudsql<span class=\"token punctuation\">-</span>proxy\n        <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"/cloud_sql_proxy\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"--dir=/cloudsql\"</span><span class=\"token punctuation\">,</span>\n                  <span class=\"token string\">\"-instances=&lt;connectionName을 써줘야함>=tcp:5432\"</span><span class=\"token punctuation\">,</span>\n                  <span class=\"token string\">\"-credential_file=/secrets/cloudsql/credentials.json\"</span><span class=\"token punctuation\">]</span>\n        <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cloudsql<span class=\"token punctuation\">-</span>oauth<span class=\"token punctuation\">-</span>credentials\n            <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /secrets/cloudsql\n            <span class=\"token key atrule\">readOnly</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ssl<span class=\"token punctuation\">-</span>certs\n            <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /etc/ssl/certs\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cloudsql\n            <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /cloudsql\n      <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cloudsql<span class=\"token punctuation\">-</span>oauth<span class=\"token punctuation\">-</span>credentials\n          <span class=\"token key atrule\">secret</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">secretName</span><span class=\"token punctuation\">:</span> cloudsql<span class=\"token punctuation\">-</span>oauth<span class=\"token punctuation\">-</span>credentials\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ssl<span class=\"token punctuation\">-</span>certs\n          <span class=\"token key atrule\">hostPath</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /etc/ssl/certs\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cloudsql\n          emptyDir<span class=\"token punctuation\">:</span></code></pre></div>\n<p>위의 설정은 아직 <strong>배포 서비스에 대한 환경 설정은 포함하지 않은 엔진 자체에 대한 정보</strong>를 담고 있다. 예를 들면 데이터베이스 설정, 장고 프로젝트를 담을 도커 이미지 설정, 그리고 볼륨에 대한 설정 등으로 구성되어 있다.</p>\n<br>\n<h2 id=\"3-장고-마이그레이션-및-어드민-생성\" style=\"position:relative;\"><a href=\"#3-%EC%9E%A5%EA%B3%A0-%EB%A7%88%EC%9D%B4%EA%B7%B8%EB%A0%88%EC%9D%B4%EC%85%98-%EB%B0%8F-%EC%96%B4%EB%93%9C%EB%AF%BC-%EC%83%9D%EC%84%B1\" aria-label=\"3 장고 마이그레이션 및 어드민 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 장고 마이그레이션 및 어드민 생성</h2>\n<p>장고 프로젝트 생성시 만든 앱을 마이그레이션 해준다. (데이터베이스를 생성하는 작업이다.)</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>manage<span class=\"token punctuation\">.</span>py makemigrations\n<span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>manage<span class=\"token punctuation\">.</span>py migrate</code></pre></div>\n<p>로컬 웹서버를 돌려서 페이지가 정상작동하는지 확인해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ ./manage.py runserver</code></pre></div>\n<br>\n<h2 id=\"4-마치며\" style=\"position:relative;\"><a href=\"#4-%EB%A7%88%EC%B9%98%EB%A9%B0\" aria-label=\"4 마치며 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 마치며</h2>\n<p>다음 포스팅에서는 정적 파일을 저장해줄 버킷을 생성하고 연동하는 방법에 대해서 알아볼 예정이다.</p>\n<br>","excerpt":"이번 포스팅에서는 서비스 계정을 생성하여 Kubernetes 엔진 환경을 구성하는 방식에 대해 설명할 예정이다. 1. 서비스 계정(Service Account) 생성 서비스 계정은 IAM 내에서 제공중이다. 해당 콘솔페이지에서 콘솔 탭메뉴의 을 선택…","tableOfContents":"<ul>\n<li><a href=\"/ggcloudDeploy_03/#1-%EC%84%9C%EB%B9%84%EC%8A%A4-%EA%B3%84%EC%A0%95service-account-%EC%83%9D%EC%84%B1\">1. 서비스 계정(Service Account) 생성</a></li>\n<li><a href=\"/ggcloudDeploy_03/#2-kubernetes%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8A%B8-%EC%97%94%EC%A7%84-%ED%99%98%EA%B2%BD%EC%84%A4%EC%A0%95-%EC%83%9D%EC%84%B1\">2. Kubernetes(쿠버네트) 엔진 환경설정 생성</a></li>\n<li><a href=\"/ggcloudDeploy_03/#3-%EC%9E%A5%EA%B3%A0-%EB%A7%88%EC%9D%B4%EA%B7%B8%EB%A0%88%EC%9D%B4%EC%85%98-%EB%B0%8F-%EC%96%B4%EB%93%9C%EB%AF%BC-%EC%83%9D%EC%84%B1\">3. 장고 마이그레이션 및 어드민 생성</a></li>\n<li><a href=\"/ggcloudDeploy_03/#4-%EB%A7%88%EC%B9%98%EB%A9%B0\">4. 마치며</a></li>\n</ul>","fields":{"slug":"/ggcloudDeploy_03/"},"frontmatter":{"title":"Google News Lab > 3. Kubernetes 엔진 생성 전 설정","date":"Jan 29, 2018","tags":["Google News Lab","Kubernetes","Django"],"keywords":["Development Note","Julia"],"update":"Jan 01, 0001"}}},"pageContext":{"slug":"/ggcloudDeploy_03/","series":[{"slug":"/ggcloudDeploy_01/","title":"Google News Lab > 1. 구글 클라우드 플랫폼을 사용한 배포 전 준비","num":1},{"slug":"/ggcloudDeploy_02/","title":"Google News Lab > 2. 프록시 서버 및 데이터베이스 구축","num":2},{"slug":"/ggcloudDeploy_03/","title":"Google News Lab > 3. Kubernetes 엔진 생성 전 설정","num":3},{"slug":"/ggcloudDeploy_04/","title":"Google News Lab > 4. Kubernetes 버킷 및 클러스터 엔진 생성","num":4},{"slug":"/ggcloudDeploy_05/","title":"Google News Lab > 5. 도커파일 생성 및 배포","num":5},{"slug":"/ggcloudDeploy_07/","title":"Google News Lab > 장고로 만든 웹사이트에 커스텀 파비콘(.ico) 적용시키기","num":7}],"lastmod":"2018-01-29"}},"staticQueryHashes":["2027115977","694178885"]}